# Celery

Celery 是一个分布式任务队列系统，用于处理异步任务。

## 为什么需要Celery?

Django 本身是同步框架，当需要处理耗时任务时（如文件处理），直接在视图中处理会导致：

- 请求响应时间长

- 服务器资源被占用

- 用户体验差

Celery 是一个分布式任务队列系统，它可以：

- 将耗时任务放到后台执行

- 管理任务的状态和结果

- 提供任务调度和重试机制

### Redis和Celery的配合

```
graph LR
    A[Django视图] -->|1.创建任务| B[Celery Broker<br/>Redis]
    B -->|2.存储任务| C[任务队列]
    D[Celery Worker] -->|3.获取任务| C
    D -->|4.执行任务| E[处理文件]
    D -->|5.存储结果| F[Result Backend<br/>Redis]
    A -->|6.查询结果| F
```

在这个流程中：

Redis 扮演两个角色：

- Broker（消息代理）：存储待执行的任务

- Result Backend（结果后端）：存储任务执行结果

Celery 扮演的角色：

- 任务调度器：管理任务的创建和分发

- Worker：执行具体的任务

- 结果管理器：处理任务状态和结果

这种架构带来的好处：

1. 解耦：任务处理与Web请求分离
2. 可扩展：可以添加更多Worker处理任务
3. 可靠性：任务失败可以重试
4. 监控：可以追踪任务状态和进度
5. 异步：不阻塞Web服务器

